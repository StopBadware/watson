@(details: ReviewDetails, user: User)
@import models.enums.ReviewStatus
@import models.enums.Role
@main("Review "+details.review.id) {
	<div class="review-nav">
	@defining(details.review.siblings) { sibs =>
		@defining(if (details.review.status.isOpen) (if (details.review.status.eq(ReviewStatus.PENDING_BAD)) "Pending" else "Open") else "Closed") { desc =>
			@defining(if (sibs("prev").isEmpty) "disabled" else "") { disabled =>
			<a href="/reviews/@sibs("prev").getOrElse(details.review.id)" role="button" class="btn btn-default" @disabled>Previous @desc</a>
			}
			@defining(if (sibs("next").isEmpty) "disabled" else "") { disabled =>
			<a href="/reviews/@sibs("next").getOrElse(details.review.id)" role="button" class="btn btn-default" @disabled>Next @desc</a>
			}
		}
	}
	</div>
	
	<div id="review-summary" class="well well-lg">
		<h3>URI: <a href="/uris/@details.uri.id">@details.uri.uri</a></h3>
		<h4>Created: <span class="unixtime-full">@details.review.createdAt</span></h4>
		<h4>Status: <span id="status" class="sbw-red review-status enum">@details.review.status</span> 
		@if(details.review.status != ReviewStatus.NEW) {
		(<span id="status-updated" class="unixtime-full">@details.review.statusUpdatedAt</span>)
		}
		</h4>
		@if(user.hasRole(Role.REVIEWER)) {
			@defining(if (details.review.isOpen) "" else "disabled") { disabled =>
			<button type="button" class="btn btn-default" @disabled>Bad</button>
			<button type="button" class="btn btn-default" @disabled>Clean</button>
			}
		}
		@if(user.hasRole(Role.VERIFIER)) {
			@defining(if (details.review.isOpen) "" else "disabled") { disabled =>
			<button type="button" class="btn btn-default" @disabled>Close Without Review</button>
			<button type="button" class="btn btn-default" @disabled>Close Bad</button>
			}
			@defining(if (details.review.status == ReviewStatus.PENDING_BAD) "" else "disabled") { disabled =>
			<button type="button" class="btn btn-default" @disabled>Send Back</button>
			}
			@defining(if (details.review.isOpen) "disabled" else "") { disabled =>
			<button type="button" class="btn btn-default" @disabled>Re-Open</button>
			}
		}
		<div>
		@details.review.reviewTags.map { tagId =>
			<h4 class="tag">@details.tags(tagId)</h4>
		}
		</div>
	</div>
	
	<div class="panel panel-default">
		<div class="panel-heading">
			<h3 class="panel-title">Blacklist Events</h3>
		</div>
	    <table id="reviews-blacklist-table" class="table table-striped table-hover table-condensed table-sorted">
	    	<thead>
	    		<tr>
	    			<th>Blacklisted By</th>
	    			<th>Blacklisted From</th>
	    			<th>Blacklisted To</th>
	    		</tr>
	    	</thead>
	    	<tbody>
	    	@details.blacklistEvents.map { event =>
				<tr class="text-right">
					<td>@event.source
						<div class="inline source-icon icon-@event.source.toString.toLowerCase">
							<span class="vis-hidden">@event.source.toString</span>
						</div>
					</td>
					<td class="unixtime-full">@event.blacklistedAt</td>
					@if(event.unblacklistedAt.nonEmpty){<td class="unixtime-full">@event.unblacklistedAt.get</td>}else{<td></td>}
				</tr>			
			}
	    	</tbody>
    	</table>
	</div>
	
	<div class="panel panel-default">
		<div class="panel-heading">
			<h3 class="panel-title">Review Requests</h3>
		</div>
	    <table id="reviews-requests-table" class="table table-striped table-hover table-condensed table-sorted">
	    	<thead>
	    		<tr>
	    			<th title="click to view full Review Request">ID</th>
	    			<th>Requester Email</th>
	    			<th>Requester IP</th>
	    			<th>Requester Notes</th>
	    			<th>Requested At</th>
	    			<th>Closed At</th>
	    			<th>Closed Reason</th>
	    			<th>Review</th>
	    		</tr>
	    	</thead>
	    	<tbody>
	    	@details.reviewRequests.map { request =>
				<tr class="text-center">
					<td><a href="/requests/@request.id">@request.id</a></td>
					<td class="text-right">@request.email</td>
					@if(request.ip.nonEmpty){<td class="ipv4 text-right" title="@request.ip.get">@request.ip.get</td>}else{<td></td>}
					<td class="text-left">@request.requesterNotes.getOrElse("")</td>
					<td class="unixtime text-right">@request.requestedAt</td>
					@if(request.closedAt.nonEmpty){<td class="unixtime text-right">@request.closedAt.get</td>}else{<td></td>}
					@if(request.closedReason.nonEmpty){<td class="enum">@request.closedReason.get</td>}else{<td></td>}
					@if(request.reviewId.nonEmpty){
						<td><a href="/reviews/@request.reviewId.get">@request.reviewId.get</a></td>
					} else {
						<td></td>
					}
				</tr>			
			}
	    	</tbody>
    	</table>
	</div>	
	
	<div class="panel panel-default">
		<div class="panel-heading">
			<h3 class="panel-title">Other Reviews</h3>
		</div>
		<div class="panel-body">
		@details.otherReviews.map { review =>
			<h4>@review</h4>			
		}
		</div>
	</div>	
	
	<div id="review-test-data" class="well well-lg watson-green-bg">
		<h4>TODO test data</h4>
	</div>	
	
	<ul class="nav nav-pills panel">
		<li class="active"><a href="#">Google</a></li>
		<li><a href="#">VirusTotal</a></li>
		<li><a href="#">DSP</a></li>
		<li><a href="#">Community Reports</a></li>
		<li><a href="#">Resolver</a></li>
	</ul>	
	
}